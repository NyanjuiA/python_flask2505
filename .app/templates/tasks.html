{# The DS 2505 site's user task page #}
{# Inherit the code from the base template #}
{% extends 'base.html' %}
{# specify the page title #}
{% block page_title %} Tasks API{% endblock page_title %}

{# Optional scripts and styles #}
{% block embed_style_or_script %}
    {# CSS code to hide the table header #}
    <style>
        #tasksTable thead {display: none;}
    </style>
{% endblock %}

{% block page_heading %}
    Fetch User Tasks Using an API
{% endblock %}

{% block page_content %}
    <h2>Get All Tasks</h2>
    <button id="getTasks">Get All Tasks</button>
    <table id="tasksTable" class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Task Name</th>
                <th>Done</th>
            </tr>
        </thead>
        <tbody id="tasksBody">
            {#  JavaScript code to fetch/get the task details #}
            <script>
                // Constants to be used in the script
                const getTasksButton = document.getElementById('getTasks');
                const tasksTableHead = document.querySelector('#tasksTable thead');
                const tasksTableBody = document.getElementById('tasksBody');

                // Function to handle the button's click event
                getTasksButton.addEventListener('click', () =>{
                    fetch('/get_tasks')
                        .then(response => response.json())
                        .then( data => {
                            tasksTableHead.style.display = 'table-header-group'; /* Show the
                             table headers which were hidden using CSS in the html document's head section. */
                            tasksTableBody.innerHTML = '';
                            data.forEach(task => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${task.id}</td>
                                    <td>${task.title}</td>
                                    <td><input type="checkbox" ${task.done ? 'checked' : ''} disabled/></td>
                                `;
                                // Add the row to the table's body
                                tasksTableBody.appendChild(row);
                            });
                        });
                });
            </script>
        </tbody>
    </table>
{% endblock %}